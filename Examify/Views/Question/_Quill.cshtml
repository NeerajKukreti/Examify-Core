<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Quill Editor with Image Upload + Resize</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <style>
        .editor-container {
            height: 200px;
        }

        .ql-editor img {
            resize: both;
            overflow: auto;
            max-width: 100%;
            max-height: 500px; /* optional */
        }
    </style>
</head>
<body>
    <h2>Quill.js Editor (with Upload + Resize)</h2>
    <div id="toolbar">
        <span class="ql-formats">
            <select class="ql-font"></select>
            <select class="ql-size"></select>
        </span>
        <span class="ql-formats">
            <button class="ql-bold"></button>
            <button class="ql-italic"></button>
            <button class="ql-underline"></button>
            <button class="ql-strike"></button>
        </span>
        <span class="ql-formats">
            <select class="ql-color"></select>
            <select class="ql-background"></select>
        </span>
        <span class="ql-formats">
            <button class="ql-script" value="sub"></button>
            <button class="ql-script" value="super"></button>
        </span>
        <span class="ql-formats">
            <button class="ql-header" value="1"></button>
            <button class="ql-header" value="2"></button>
            <button class="ql-blockquote"></button>
            <button class="ql-code-block"></button>
        </span>
        <span class="ql-formats">
            <button class="ql-list" value="ordered"></button>
            <button class="ql-list" value="bullet"></button>
            <button class="ql-indent" value="-1"></button>
            <button class="ql-indent" value="+1"></button>
        </span>
        <span class="ql-formats">
            <button class="ql-direction" value="rtl"></button>
            <select class="ql-align"></select>
        </span>
        <span class="ql-formats">
            <button class="ql-link"></button>
            <button class="ql-image"></button>
            @* <button class="ql-video"></button> *@
            <button class="ql-formula"></button>
        </span>
        <span class="ql-formats">
    </div>
    <div id="editor-container"></div>

    <!-- Quill core -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Image resize module -->
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>

    <script>
        // Register resize module
        Quill.register('modules/imageResize', window.ImageResize.default);

        const quill = new Quill('#editor-container', {
          theme: 'snow',
          debug: 'info',
            placeholder: 'Compose a question...',
          modules: {
            toolbar: {
              container: "#toolbar",
              handlers: {
                image: imageHandler   // custom handler
              }
            },
            imageResize: {
            modules: ['Resize', 'DisplaySize', 'Toolbar'],
            preserveRatio: false,
            handleStyles: {
              topLeft: { cursor: 'nwse-resize' },
              topRight: { cursor: 'nesw-resize' },
              bottomLeft: { cursor: 'nesw-resize' },
              bottomRight: { cursor: 'nwse-resize' }
            }
            },
            fornula: true
        }});

        // Custom image upload handler
        function imageHandler() {
          const input = document.createElement('input');
          input.setAttribute('type', 'file');
          input.setAttribute('accept', 'image/*');
          input.click();

          input.onchange = async () => {
            const file = input.files[0];
            if (file) {
              const formData = new FormData();
              formData.append('file', file);

              // ⚡ Replace this with your API endpoint
              const response = await fetch('/Question/uploads', {
                method: 'POST',
                body: formData
              });

              const data = await response.json();
              const range = quill.getSelection();
              // Insert uploaded image URL
              quill.insertEmbed(range.index, 'image', data.url);
            }
          };
        }

        // Example save
        function saveData() {
          const content = quill.root.innerHTML;
          console.log("Editor content:", content);
          alert("Saved content:\n" + content);
        }
    </script>

    <button onclick="saveData()">Save</button>
</body>
</html>
